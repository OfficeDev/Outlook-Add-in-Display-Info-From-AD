---
page_type: sample
products:
- office-outlook
- office-365
languages:
- javascript
extensions:
  contentType: samples
  technologies:
  - Add-ins
  platforms:
  - CSS
  createdDate: 8/17/2015 11:29:52 AM
---
# Outlook-Add-in-Display-Info-From-AD
Из этого прототипа почтовой надстройки вы узнаете, как получить доступ к информации об основной иерархии из Active Directory (AD). Расширьте этот прототип, чтобы настроить почтовую надстройку для своей организации.

**Описание образца почтовой надстройки Who's Who AD**

Этот образец сопровождает тему [Как: Создайте почтовое приложение для отображения информации об иерархии из Active Directory](http://blogs.msdn.com/b/officeapps/archive/2013/05/15/creating-a-mail-app-to-check-out-active-directory-org-information-for-mail-senders-and-recipients.aspx) в приложениях для Office и блоге SharePoint.

Когда вы выбираете сообщение электронной почты в Outlook или Outlook Web App, вы можете выбрать надстройку почты Who's Who AD для отображения информации Active Directory об отправителе и других получателях сообщения электронной почты, выбранного в настоящее время в Outlook или Outlook Web App. Надстройка почты появляется на панели приложения при просмотре электронной почты в области чтения или в проводнике почты.

При первом выборе этой почтовой надстройки она извлекает и отображает подробную профессиональную и иерархическую информацию отправителя из Active Directory - имя, должность, отдел, псевдоним, номер офиса, номер телефона и эскиз изображения. Если у отправителя есть менеджер или прямые отчеты, надстройка почты также отображает аналогичный набор информации для каждого из них. На рисунке 1 показан пример надстройки Who's Who AD. Снимок экрана отображает информацию для Белинды Ньюман, ее менеджера и прямые отчеты.


![Рис. 1. Почтовое приложение отображает информацию Active Directory для отправителя электронной почты в Outlook. ](/description/image.png "Почтовое приложение Who's Who AD показывает плитки для каждого человека с фотографией, именем и должностью.")
 
Надстройка почты обеспечивает панель навигации, которая позволяет выбрать получателя и просмотреть подробную профессиональную информацию и информацию об иерархии, которая хранится в Active Directory.

За кулисами, когда вы выбираете отправителя или получателя, надстройка почты вызывает веб-службу с именем Кто для получения данных этого человека из Active Directory. Веб-служба включает оболочку Active Directory, которая использует доменные службы Active Directory (AD DS) для доступа к информации из Active Directory. После получения данных веб-служба Who сериализует данные в формате JSON и отправляет их обратно в качестве ответа веб-службы. Почтовая надстройка затем извлекает данные и отображает их на панели надстройки. На рис. 2 суммированы отношения между пользователем Outlook, почтовым приложением, веб-службой Who и Active Directory.

![Рис. 2. Отношения между пользователем Outlook, почтовым приложением, веб-службой Who и Active Directory](/description/75964e99-a74f-4fd3-a4e1-a0ca40bfc5a4image.png ". Пользователь взаимодействует с почтовым приложением и AD; почта взаимодействует с пользователем и веб-сервисом; веб-сервис взаимодействует с почтовым приложением и AD.")

 
Смотрите сопроводительную статью [Как: Создайте почтовое приложение для отображения информации об иерархии из Active Directory](http://blogs.msdn.com/b/officeapps/archive/2013/05/15/creating-a-mail-app-to-check-out-active-directory-org-information-for-mail-senders-and-recipients.aspx) в приложениях для Office и блоге SharePoint для описания реализации почтовой надстройки и веб-службы Who.

**Примечание**

Веб-служба Who служит только прототипом и показывает несколько основных функций Active Directory, которые знакомы большинству пользователей Active Directory. Надеемся, что этот пример послужит хорошей отправной точкой для расширения и поддержки функций, характерных для вашей организации. 
 
**Предварительные требования**

Чтобы максимально использовать этот пример кода, вы должны быть знакомы с веб-разработкой с использованием HTML и JavaScript, а также с веб-службами Windows Communication Foundation (WCF). Вам не требуется предварительное знание доменных служб Active Directory.

Ниже приведены требования для установки и запуска любой почтовой надстройки, включая почтовую надстройку Who's Who AD:

* Почтовый ящик пользователя должен размещаться в Exchange Server 2013 или более поздней версии.
* Почтовое приложение должно работать в Outlook 2013 или более поздней версии или в Outlook Web App.

Вы можете использовать любой знакомый вам инструмент веб-разработки для разработки почтового приложения Кто есть кто AD.

Для разработки веб-службы Who и развертывания почтового приложения и веб-службы использовались следующие инструменты:

* Visual Studio 2012
* .NET Framework 4.0
* Windows Server 2008
* Internet Information Server (IIS) 7.0

**Ключевые компоненты примера**

Загрузка для этого образца состоит из следующих файлов и папок:

* Manifest.xml - это файл манифеста для почтовой надстройки Who's Who AD.
* WhoMailApp.sln - это файл решения Visual Studio для всего примера.
* Папка WhoAgave содержит файлы для почтовой надстройки (включая файлы HTML, изображения и CSS), а также некоторые файлы для веб-службы Who.
* Папка ActiveDirectory содержит файлы для оболочки Active Directory.
* Папка BuildProcessTemplates содержит файлы шаблонов разметки по умолчанию для разработки веб-служб WCF.

**Настройка примера**

Чтобы получить файлы и изменить их ссылки, выполните следующие действия:

1. На локальном диске, например, d :, создайте папку с именем WhosWhoAD и загрузите туда файлы примеров.
2. Предполагая, что веб-сервер IIS, на котором вы собираетесь разместить почтовое приложение Who's Who AD, называется веб-сервером, создайте папку с именем WhosWhoAD в папке \\webserver\c$\inetpub\wwwroot.
3. Скопируйте папку img и ее содержимое из d:\WhosWhoAD\WhoAgave\ to \\webserver\c$\inetpub\wwwroot\WhosWhoAD.
Оставшиеся почтовые надстройки и файлы веб-службы будут соответствующим образом скопированы на веб-сервер при развертывании веб-службы, как описано в разделе «Развертывание веб-службы» ниже.
4. Обновите файл манифеста, чтобы отразить фактическое местоположение HTML-файла почтовой надстройки.

Файл манифеста почтовой надстройки manifest.xml находится непосредственно в каталоге d:\\WhosWhoAD. Если ваш реальный веб-сервер имеет имя, отличное от имени веб-сервера, обновите файл manifest.xml, чтобы отразить фактическое расположение файла WhoMailApp.html, заменив веб-сервер в следующей строке на путь сервера к папке WhosWhoAD, созданной на шаге 2.

```XML
<SourceLocation DefaultValue="https://webserver/WhosWhoAD/WhoMailApp.html"/>
 ```

**Установка почтовой надстройки**

1. В расширенном клиенте Outlook выберите «Файл», «Управление приложениями». Это открывает браузер для входа в Outlook Web App и перехода в Центр администрирования Exchange (EAC).
2. Войдите в свою учетную запись Exchange.
3. В EAC выберите раскрывающийся список рядом с кнопкой +, а затем выберите «Добавить из файла», как показано на рисунке
![рисунок 3. Установка почтового приложения из файла в Центре администрирования Exchange.](/description/f7a57314-42f1-4d15-9752-60e45ade98c3image.png " В меню кнопки «плюс» отображаются параметры «Добавить из магазина Office», «Добавить из URL» и «Добавить из файла».")

4. В диалоговом окне добавления из файла найдите расположение файла manifest.xml в d:\\WhosWhoAD, выберите «Открыть», а затем нажмите «Далее».
Затем вы должны увидеть надстройку Who's Who AD в списке надстроек для Outlook, как показано на рисунке 4.
![Рис. 4. Приложение Who's Who AD установлено в Центре администрирования Exchange. ](/description/3977704e-6d30-4067-bb17-e5d1f778795cimage.png "Приложение Who's Who AD, указанное на странице приложений для Outlook, показывается как включенное для пользователя.")

5. Если Outlook работает, закройте и снова откройте Outlook.

**Примечание**
Эта процедура применима, только если ваша учетная запись Outlook установлена на Exchange Server 2013 или более поздней версии.
 
Кроме того, на шаге 3, если вы не видите опцию Добавить из файла, вам нужно запросить у администратора Exchange необходимые вам разрешения.

Администратор Exchange может выполнить следующий командлет PowerShell, чтобы назначить необходимые разрешения одному пользователю. В этом примере wendyri - это псевдоним электронной почты пользователя.

```POWERSHELL
New-ManagementRoleAssignment -Role "My Custom Apps" -User "wendyri"
 ```

При необходимости администратор может запустить следующий командлет, чтобы назначить аналогичные разрешения для нескольких пользователей:

```POWERSHELL
$users = Get-Mailbox *
$users | ForEach-Object { New-ManagementRoleAssignment -Role "My Custom Apps" -User $_.Alias}
 ```

Для получения дополнительной информации о роли Мои пользовательские приложения см. [Роль Мои пользовательские приложения](http://msdn.microsoft.com/library/aa0321b3-2ec0-4694-875b-7a93d3d99089(Office.15).aspx).

**Разверните веб-сервис**

Чтобы развернуть веб-службу Who и файл почтовой надстройки WhoMailApp.html, выполните следующие действия:

1. В Visual Studio откройте WhoWebService.csproj.
2. Выберите Build, опубликуйте WhoWebService.
3. На вкладке «Профиль» диалогового окна «Публикация в Интернете» укажите нужный профиль.
4. На вкладке «Соединение» выберите «Файловая система» в качестве метода публикации.
5. Введите \\webserver\c$\inetpub\wwwroot\WhosWhoAD в качестве целевого местоположения.
6. Щелкните Опубликовать.
7. На компьютере веб-сервера запустите диспетчер IIS.
8. На панели «Подключения» выберите «Сайты», «Веб-сайт по умолчанию».
9. Щелкните правой кнопкой мыши папку WhosWhoAD и выберите «Преобразовать в приложение».
10. В диалоговом окне «Добавление приложения» в разделе «Пул приложений», в котором по умолчанию указан DefaultAppPool, выберите «Выбрать».
11. В диалоговом окне Выбор пула приложений в разделе Свойства убедитесь, что версия .Net Framework: 4.0 или более поздняя версия .NET Framework отображается. При необходимости выберите другой пул приложений, чтобы убедиться, что пул использует как минимум .NET Framework 4.0. Нажмите кнопку ОК.
12. В диалоговом окне Add Application убедитесь, что вы видите сквозную аутентификацию, как показано на рисунке 6. Нажмите кнопку ОК. Перейдите к Шагу 14.
![Рис. 5. Диалоговое окно «Добавить приложение» для преобразования веб-службы «Кто» в приложение в соответствующем пуле приложений в IIS. ](/description/584495fd-6e4d-45da-9b5b-47d114848342image.png "Диалоговое окно «Добавить приложение» с текстом сквозной аутентификации.")

13. В качестве альтернативы шагам с 10 по 12 вы можете создать новый пул приложений, который использует .NET Framework 4.0 (или более позднюю версию) и сквозную аутентификацию. Выберите этот пул приложений и перейдите к шагу 14.
14. На средней панели диспетчера IIS выберите Аутентификация. Убедитесь, что аутентификация Windows включена; щелкните правой кнопкой мыши, чтобы включить его, если это необходимо.

Процедура развертывания копирует следующие файлы в \\webserver\c$\inetpub\wwwroot\WhosWhoAD\:
* bin\ActiveDirectoryWrapper.dll
* bin\WhoWebService.dll
* css\WhoMailApp.css
* img\anonymous.jpg
* img\app_icon.png
* img\envelop.png
* img\telephone.png
* Web.config
* WhoMailApp.html
* WhoService.svc

Доступ к веб-службе Who теперь можно получить через веб-сервер, и теперь вы можете использовать почтовое приложение Who's Who AD в Outlook или Outlook Web App.

**Запуск и проверка примера**

1. В Outlook выберите письмо для чтения в панель чтения.
2. Выберите почтовую надстройку Who's Who AD на панели надстроек.

Вы должны увидеть данные Active Directory на панели надстроек, как показано на рисунке 1.

<a name="Troubleshooting"></a>
**Устранение неполадок**

Если у отправителя или получателя сообщения электронной почты есть адрес электронной почты в форме <first name>.<last name>@<domain>, возможно, она не сможет найти нужного пользователя в Active Directory. Выберите пользователя, адрес электронной почты которого — только в форме <alias>@<domain>.

Поскольку почтовая надстройка Who's Who предназначена для использования в качестве прототипа, у вас есть возможность настроить почтовый надстройку в соответствии с требованиями вашей организации. См. Раздел «Будущее расширение» в сопроводительной статье для получения дополнительной информации.

**Связанное содержимое**

* [Дополнительные примеры надстроек](https://github.com/OfficeDev?utf8=%E2%9C%93&query=-Add-in)
* [ Создайте почтовое приложение для отображения информации об иерархии из Active Directory](https://blogs.msdn.microsoft.com/officeapps/2013/05/15/creating-a-mail-app-to-check-out-active-directory-org-information-for-mail-senders-and-recipients/)


Этот проект соответствует [Правилам поведения разработчиков открытого кода Майкрософт](https://opensource.microsoft.com/codeofconduct/). Дополнительные сведения см. в разделе [часто задаваемых вопросов о правилах поведения](https://opensource.microsoft.com/codeofconduct/faq/). Если у вас возникли вопросы или замечания, напишите нам по адресу [opencode@microsoft.com](mailto:opencode@microsoft.com).
